---
import { BlogWithID } from "component/page/blogs/[id]/BlogWithID";
import { getBlog } from "microcms/query/blogs";
import { isFailure } from "result";

import { microCMS } from "../../config/microcms";

export type Params = { id: string };
const draftKey = Astro.url.searchParams.get("draftKey");

const params = Astro.params;
if (!params.id) return new Response(undefined, { status: 400 });

const blog = await getBlog(
  microCMS(Astro.request),
  params.id,
  ["title", "content", "updatedAt", "publishedAt", "eyecatch", "status"],
  { draftKey: draftKey ?? undefined },
);

if (isFailure(blog)) {
  return new Response(undefined, { status: 404 });
}

const props = blog.value;
---

<BlogWithID blog={props} />
