---
export const prerender = false;

import { microCMS } from "@/config/microCMS";
import BaseLayout from "@/layouts/BaseLayout.astro";
import { isFailure } from "@/lib/result";
import { getBlog } from "@/query/blogs";
import BlogContent, {
    BlogContentIds,
    blogContentIds,
} from "@/components/Blog/Content.astro";
import type { Blog } from "@/query/blogs";

export type Props = Blog;

const { id } = Astro.params;
if (!id) {
    return Astro.redirect("/blogs/ssr");
}

const client = microCMS(Astro.request);
const result = await getBlog<BlogContentIds>(client, id, blogContentIds);
if (isFailure(result)) {
    console.error(result);
    return Astro.redirect("/error/", 301);
}
console.info(JSON.stringify(result));

const blog = result.value;
---

<BaseLayout title={blog.title}>
    <BlogContent blog={blog} />
</BaseLayout>
