---
import { microCMS } from "@/config/microCMS";
import BaseLayout from "@/layouts/BaseLayout.astro";
import { isFailure } from "@/lib/result";
import { getBlogs } from "@/query/blogs";
import BlogContent, { BlogContentIds, BlogProps, blogContentIds } from "@/components/Blog/Content.astro";

export type Props = BlogProps["blog"];

export async function getStaticPaths(): Promise<
    {
        params: { id: string };
        props: Props;
    }[]
> {
    const client = microCMS();

    const result = await getBlogs<BlogContentIds>(client, blogContentIds);
    if (isFailure(result)) {
        throw result;
    }
    console.info(JSON.stringify(result));

    const blogs = result.value;

    return blogs.contents.map((blog) => ({
        params: {
            id: blog.id,
        },
        props: blog,
    }));
}

const blog = Astro.props;
---

<BaseLayout title={blog.title}>
    <BlogContent blog={blog} />
</BaseLayout>
